<script>
    function loadScript(url, isModule, callback) {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        if (isModule) {
            script.type = 'module'
        }
        if (callback) {
            script.addEventListener('load', () => {
                callback()
            })
        }
        document.body.appendChild(script)
    }

    const container = document.getElementById('container')
    const mobileNavAnimDuration = 200
    let isMobileNavAnim = false

    const startMobileNavAnim = () => isMobileNavAnim = true
    const stopMobileNavAnim = () => setTimeout(() => isMobileNavAnim = false, mobileNavAnimDuration)

    document.getElementById('main-nav-toggle').addEventListener('click', () => {
        if (isMobileNavAnim) {
            return
        }
        startMobileNavAnim()
        container.classList.contains('mobile-nav-on') ? container.classList.remove('mobile-nav-on') : container.classList.add('mobile-nav-on')
        stopMobileNavAnim()
    })

    document.getElementById('wrap').addEventListener('click', () => {
        if (isMobileNavAnim || !container.classList.contains('mobile-nav-on')) {
            return
        }
        container.classList.remove('mobile-nav-on')
    })

    if (document.getElementsByClassName('article-entry')[0]) {
        const imgs = document.getElementsByClassName('article-entry')[0].getElementsByTagName('img')
        Array.from(imgs).forEach(img => {
            const title = img.getAttribute('title')
            if (title) {
                const caption = document.createElement('span')
                caption.innerHTML = title
                caption.setAttribute('class', 'caption')
                img.parentElement.appendChild(caption)
            }
        })
    }

    window.lazyLoadOptions = {}
    loadScript('https://cdn.jsdelivr.net/npm/vanilla-lazyload@17.5.0/dist/lazyload.min.js')

    loadScript('https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js', false, () => {
        mediumZoom('.medium-zoom', {
            margin: 24,
            background: '#000000c0'
        })
    })

    setTimeout(() => {
        const fonts = document.createElement('link')
        fonts.href = '/css/fonts.css'
        fonts.rel = 'stylesheet'
        document.getElementsByTagName('head')[0].appendChild(fonts)
    }, 3000)

    loadScript('/js/darkreader.js', false, () => {
        if (sessionStorage.getItem('theme')) {
            sessionStorage.getItem('theme') === 'dark' ? DarkReader.enable() : DarkReader.disable()
        } else {
            DarkReader.auto()
        }

        document.getElementById('dark-switch').addEventListener('click', () => {
            if (DarkReader.isEnabled()) {
                DarkReader.disable()
                sessionStorage.setItem('theme', 'light')
            } else {
                DarkReader.enable()
                sessionStorage.setItem('theme', 'dark')
            }
        })
    })

    if (document.getElementById('comment')) {
        const data = document.getElementById('comment').dataset
        data.articleId = data.articleId.substring(1, data.articleId.length - 1)
        loadScript('/js/wind-comment.umd.min.js')
    }
</script>