<script>
  function loadScript(url, isModule, callback) {
    const script = document.createElement('script')
    script.src = url
    script.async = true
    if (isModule) {
      script.type = 'module'
    }
    if (callback) {
      script.addEventListener('load', () => {
        callback()
      })
    }
    document.body.appendChild(script)
  }

  const body = document.body
  const menu = document.querySelector('#menu')
  let menuIsShow = false
  document.querySelector('#menu-button').addEventListener('click', () => {
    if (menuIsShow) {
      menu.style.opacity = '0'
      setTimeout(() => {
        menu.style.display = 'none'
      }, 150)
      body.style.overflow = 'visible'
    } else {
      menu.style.display = 'flex'
      setTimeout(() => {
        menu.style.opacity = '1'
      }, 1)
      body.style.overflow = 'hidden'
    }
    menuIsShow = !menuIsShow
  })

  window.lazyLoadOptions = {}
  loadScript('https://npm.elemecdn.com/vanilla-lazyload@17.5.0/dist/lazyload.min.js')

  loadScript('https://npm.elemecdn.com/medium-zoom@1.0.6/dist/medium-zoom.min.js', false, () => {
    mediumZoom('.medium-zoom', {
      margin: 24,
      background: '#000000c0'
    })
  })

  setTimeout(() => {
    const fonts = document.createElement('link')
    fonts.href = '/css/fonts.css'
    fonts.rel = 'stylesheet'
    document.getElementsByTagName('head')[0].appendChild(fonts)
  }, 3000)

  loadScript('/js/prism.js')

  loadScript('https://npm.elemecdn.com/katex@0.15.3/dist/katex.min.js', false, () => {
    loadScript('https://npm.elemecdn.com/katex@0.15.3/dist/contrib/auto-render.min.js', false, () => {
      renderMathInElement(document.body, {
        delimiters: [
          { left: '$$', right: '$$', display: true },
          { left: '$', right: '$', display: false },
        ]
      })
      if (document.getElementById('comment')) {
        const comment = document.getElementById('comment')
        comment.dataset.articleId = btoa(comment.dataset.articleId.substring(18, comment.dataset.articleId.length - 1))
        if (!document.getElementById('article-nav')) {
          comment.style.marginTop = '50px'
        }
        loadScript('/js/wind-comment.umd.min.js')
      }
    })
  })
</script>